
      <div class="panel panel-default">
        <div class="panel-body row">

          <form class="form-inline" role="form">

            {#
            <input type="hidden" id="id_" name="id_" value="{{ run }}">
            #}

            <div class="col-sm-4">
              <div class="form-group form-group-sm">

                <label class="control-label col-sm-4" for="run">Run</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control typeahead" id="run" name="run" value="{{ run }}" placeholder="{{ run }}">
                </div>

              </div>
            </div>

            <div class="col-sm-4">
              <div class="form-group form-group-sm">

                <label class="control-label col-sm-4" for="subrun">Sub-run</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="subrun" name="subrun" value="{{ subrun }}" placeholder="{{ subrun }}">
                </div>

              </div>
            </div>

            <div class="col-sm-2">
              <div class="form-group form-group-sm">

                <button type="submit" class="btn btn-default btn-outline">Submit</button>

              </div>
            </div>

          </form>

            <div class="col-sm-2">
              <div class="form-group form-group-sm checkbox">
                <label><input id="checkbox" type="checkbox" value="">Live</label>
              </div>
            </div>

        </div>
      </div>

      <script type="text/javascript">
      $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
      </script>

      <script src="{{ url_for('static', filename='lib/jquery/js/jquery.min.js') }}"></script>
      <script src="{{ url_for('static', filename='lib/typeahead.js/typeahead.bundle.min.js') }}"></script>

      <script type="text/javascript">
      this.$RUN = "{{ run }}";
      this.$SUBRUN = "{{ subrun }}";

      //if ($RUN == "None") {
      //    $RUN = "latest"
      //};

      //if ($RUN == "latest") {
      //    $.getJSON($SCRIPT_ROOT + '/json/latest-runs?limit=1', function(data) {
      //        console.log(data.results[0].run);
      //        $("#run").val(data.results[0].run);
      //    });
      //}

      this.$UPDATE = false;
      </script>

      <script type="text/javascript">
      $(document).ready(function () {
          if (window.location.href.indexOf("?live") > -1) {
{% if active_page not in no_live %}
              $('#checkbox').attr('checked', true);
              $UPDATE = true;
              $RUN = "latest";
{% endif %}
          } else {
              $('#checkbox').attr('checked', false);
              $UPDATE = false;
          }
      });
      </script>

{#
    http://stackoverflow.com/questions/11498957/jquery-removing-everything-after-question-mark-in-url
    http://jsbin.com/xikufatohi/1/edit?js,console
#}

      <script type="text/javascript">
      var getURL = function(url) {
          if (url.indexOf('?') === -1) {
              return {
                  base : url,
                  query : ''
              };
          } else {
              return {
                  base : url.substring(0, url.indexOf('?')),
                  query : url.substring(url.indexOf('?'))
              };
          }
      };

      function urlLive() {
          $('ul.navbar-nav li a, div.list-group a').attr('href', function(index, value) {
              var url = getURL(value);
              //console.log('url.base', url.base)
              //console.log('url.query', url.query)
              //console.log('value', value)
              //console.log('index', index)
              return url.base + '?live';
          });
      };

      function urlRunSubrun() {
          $('ul.navbar-nav li a, div.list-group a').attr('href', function(index, value) {
              var url = getURL(value);
              //console.log('url.base', url.base)
              //console.log('url.query', url.query)
              //console.log('value', value)
              //console.log('index', index)
              return url.base + '?run=' + $RUN + '&subrun=' + $SUBRUN;
          });
      };
      </script>

      <script type="text/javascript">
      $(document).ready(function () {
          if ($('#checkbox').is(":checked")) {
              console.log('Checked');
              urlLive();
{% if active_page in no_live %}
{% endif %}
          } else {
              urlRunSubrun();
          }
      });
      </script>

      <script type="text/javascript">
      $('#checkbox').change(function() {
        if ($(this).is(':checked')) {
            console.log('Checked');
            $UPDATE = true;
            //$RUN = "latest";
            window.location.replace("{{ request.path }}?live");
        } else {
            console.log('Unchecked');
            $UPDATE = false;
            urlRunSubrun();
        }
      });
      </script>

      <script>
      // https://github.com/twitter/typeahead.js/pull/703

      $(document).ready(function() {
          // instantiate the bloodhound suggestion engine
          var engine = new Bloodhound({
              datumTokenizer: function(datum) {
                  return Bloodhound.tokenizers.whitespace(datum.run);
              },
              queryTokenizer: Bloodhound.tokenizers.whitespace,
              prefetch: {
                  url: $SCRIPT_ROOT + "/json/latest-runs?limit=100",
                  filter: function(data) {
                      //console.log("data", data.results)
                      return $.map(data.results, function(result) {
                          return {
                              run: result.run,
                              subruns: result.subruns
                          };
                      });
                  },
                  cache: false
              }
          });

          // initialize the bloodhound suggestion engine
          engine.initialize();

          // instantiate the typeahead UI
          $('.typeahead').typeahead(
              {
                  hint: true,
                  highlight: true,
                  minLength: 1
              },
              {
                  name: 'engine',
                  displayKey: 'run',
                  source: engine.ttAdapter(),
          });

          function updateCache() {
              // clear suggestions loaded from local and prefetch
              engine.clear();

              // clear prefetch data stored in local storage
              engine.clearPrefetchCache();

              // clear cache of responses generated by remote requests
              engine.clearRemoteCache();

              // reinitialize the suggestion engine, i.e., load data 
              // from `local` and `prefetch`
              engine.initialize(true); // have to pass true in order to reinitialize
          }

          var timeout;
          function loadNext() {
              updateCache();
              timeout = setTimeout(loadNext, 60000);
          }

          setTimeout(loadNext, 30000);
      });
      </script>

